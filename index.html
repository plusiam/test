<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆìŒì¼ê¸° - ë‚˜ì˜ ê°ì • ê¸°ë¡ì¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #a78bfa;
            --secondary-color: #fbbf24;
            --bg-light: #faf5ff;
            --bg-dark: #1f2937;
        }
        
        .dark {
            --bg-light: #1f2937;
            --text-color: #f3f4f6;
        }
        
        .emotion-btn {
            transition: all 0.3s ease;
        }
        
        .emotion-btn:hover {
            transform: scale(1.1);
        }
        
        .emotion-btn.selected {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(167, 139, 250, 0.5);
        }
        
        .calendar-day {
            min-height: 80px;
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 640px) {
            .calendar-day {
                min-height: 60px;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body class="bg-purple-50 min-h-screen">
    <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ëª¨ë‹¬ -->
    <div id="passwordModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 max-w-md w-full">
            <h3 class="text-xl font-semibold mb-4">ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h3>
            <input type="password" id="passwordInput" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <div class="mt-4 flex gap-2">
                <button onclick="checkPassword()" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600">í™•ì¸</button>
                <button onclick="skipPassword()" class="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400">ê±´ë„ˆë›°ê¸°</button>
            </div>
            <p class="text-sm text-gray-500 mt-2">ì²˜ìŒ ë°©ë¬¸ì´ì‹œë©´ ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”</p>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- í—¤ë” -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-purple-800 mb-2">ë§ˆìŒì¼ê¸° ğŸ“–</h1>
            <p class="text-gray-600">ì˜¤ëŠ˜ì˜ ê°ì •ì„ ê¸°ë¡í•˜ê³ , ë‚˜ì˜ ë§ˆìŒì„ ë“¤ì—¬ë‹¤ë³´ì„¸ìš”</p>
            <div class="mt-4 flex justify-center gap-4">
                <button onclick="toggleDarkMode()" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
                    ğŸŒ™ ë‹¤í¬ëª¨ë“œ
                </button>
                <button onclick="showSettings()" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
                    âš™ï¸ ì„¤ì •
                </button>
            </div>
        </header>

        <!-- íƒ­ ë©”ë‰´ -->
        <div class="flex flex-wrap justify-center gap-2 mb-8">
            <button onclick="showTab('write')" class="tab-btn px-6 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                âœï¸ ì¼ê¸° ì“°ê¸°
            </button>
            <button onclick="showTab('calendar')" class="tab-btn px-6 py-3 bg-white rounded-lg hover:bg-gray-100">
                ğŸ“… ê°ì • ë‹¬ë ¥
            </button>
            <button onclick="showTab('stats')" class="tab-btn px-6 py-3 bg-white rounded-lg hover:bg-gray-100">
                ğŸ“Š í†µê³„ ë³´ê¸°
            </button>
            <button onclick="showTab('list')" class="tab-btn px-6 py-3 bg-white rounded-lg hover:bg-gray-100">
                ğŸ“‹ ì¼ê¸° ëª©ë¡
            </button>
        </div>

        <!-- ì¼ê¸° ì“°ê¸° íƒ­ -->
        <div id="writeTab" class="tab-content bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-semibold mb-6 text-center">ì˜¤ëŠ˜ì˜ ë§ˆìŒì€ ì–´ë–¤ê°€ìš”?</h2>
            
            <!-- ê°ì • ì„ íƒ -->
            <div class="mb-6">
                <p class="text-lg mb-4 text-center">ì˜¤ëŠ˜ì˜ ê°ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                <div class="grid grid-cols-3 sm:grid-cols-6 gap-4 max-w-2xl mx-auto">
                    <button onclick="selectEmotion('happy', 'ğŸ˜Š')" class="emotion-btn p-4 bg-yellow-100 rounded-lg hover:bg-yellow-200">
                        <span class="text-4xl">ğŸ˜Š</span>
                        <p class="text-sm mt-1">í–‰ë³µ</p>
                    </button>
                    <button onclick="selectEmotion('sad', 'ğŸ˜¢')" class="emotion-btn p-4 bg-blue-100 rounded-lg hover:bg-blue-200">
                        <span class="text-4xl">ğŸ˜¢</span>
                        <p class="text-sm mt-1">ìŠ¬í””</p>
                    </button>
                    <button onclick="selectEmotion('angry', 'ğŸ˜¡')" class="emotion-btn p-4 bg-red-100 rounded-lg hover:bg-red-200">
                        <span class="text-4xl">ğŸ˜¡</span>
                        <p class="text-sm mt-1">í™”ë‚¨</p>
                    </button>
                    <button onclick="selectEmotion('anxious', 'ğŸ˜°')" class="emotion-btn p-4 bg-purple-100 rounded-lg hover:bg-purple-200">
                        <span class="text-4xl">ğŸ˜°</span>
                        <p class="text-sm mt-1">ë¶ˆì•ˆ</p>
                    </button>
                    <button onclick="selectEmotion('peaceful', 'ğŸ˜Œ')" class="emotion-btn p-4 bg-green-100 rounded-lg hover:bg-green-200">
                        <span class="text-4xl">ğŸ˜Œ</span>
                        <p class="text-sm mt-1">í‰ì˜¨</p>
                    </button>
                    <button onclick="selectEmotion('excited', 'ğŸ¤—')" class="emotion-btn p-4 bg-orange-100 rounded-lg hover:bg-orange-200">
                        <span class="text-4xl">ğŸ¤—</span>
                        <p class="text-sm mt-1">ì„¤ë ˜</p>
                    </button>
                </div>
            </div>

            <!-- ë‚ ì§œ ì„ íƒ -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">ë‚ ì§œ</label>
                <input type="date" id="diaryDate" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400">
            </div>

            <!-- ì¼ê¸° ë‚´ìš© -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">ì˜¤ëŠ˜ì˜ ì¼ê¸°</label>
                <textarea id="diaryContent" rows="6" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400" 
                    placeholder="ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”? ë§ˆìŒì† ì´ì•¼ê¸°ë¥¼ í¸í•˜ê²Œ ì ì–´ì£¼ì„¸ìš”..."></textarea>
            </div>

            <!-- ê°ì‚¬í•œ ì¼ -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">ì˜¤ëŠ˜ ê°ì‚¬í•œ ì¼ 3ê°€ì§€</label>
                <div class="space-y-2">
                    <input type="text" id="grateful1" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400" 
                        placeholder="1. ì²« ë²ˆì§¸ ê°ì‚¬í•œ ì¼">
                    <input type="text" id="grateful2" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400" 
                        placeholder="2. ë‘ ë²ˆì§¸ ê°ì‚¬í•œ ì¼">
                    <input type="text" id="grateful3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400" 
                        placeholder="3. ì„¸ ë²ˆì§¸ ê°ì‚¬í•œ ì¼">
                </div>
            </div>

            <!-- ì¶”ê°€ ì •ë³´ -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ì˜¤ëŠ˜ì˜ ë‚ ì”¨</label>
                    <select id="weather" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="sunny">â˜€ï¸ ë§‘ìŒ</option>
                        <option value="cloudy">â˜ï¸ íë¦¼</option>
                        <option value="rainy">ğŸŒ§ï¸ ë¹„</option>
                        <option value="snowy">â„ï¸ ëˆˆ</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">í•¨ê»˜í•œ ì‚¬ëŒ</label>
                    <input type="text" id="withPerson" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400" 
                        placeholder="ì˜ˆ: ê°€ì¡±, ì¹œêµ¬, í˜¼ì">
                </div>
            </div>

            <!-- ì €ì¥ ë²„íŠ¼ -->
            <div class="text-center">
                <button onclick="saveDiary()" class="px-8 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 text-lg font-medium">
                    ğŸ’¾ ì¼ê¸° ì €ì¥í•˜ê¸°
                </button>
            </div>
        </div>

        <!-- ê°ì • ë‹¬ë ¥ íƒ­ -->
        <div id="calendarTab" class="tab-content hidden bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-semibold mb-6 text-center">ê°ì • ë‹¬ë ¥</h2>
            <div class="mb-4 flex justify-center gap-4">
                <button onclick="changeMonth(-1)" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">â—€</button>
                <h3 id="currentMonth" class="text-xl font-medium flex items-center"></h3>
                <button onclick="changeMonth(1)" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">â–¶</button>
            </div>
            <div id="calendar" class="grid grid-cols-7 gap-2"></div>
            
            <!-- ê°ì • ë²”ë¡€ -->
            <div class="mt-6 flex flex-wrap justify-center gap-2">
                <div class="flex items-center gap-1"><span class="w-4 h-4 bg-yellow-200 rounded"></span> í–‰ë³µ</div>
                <div class="flex items-center gap-1"><span class="w-4 h-4 bg-blue-200 rounded"></span> ìŠ¬í””</div>
                <div class="flex items-center gap-1"><span class="w-4 h-4 bg-red-200 rounded"></span> í™”ë‚¨</div>
                <div class="flex items-center gap-1"><span class="w-4 h-4 bg-purple-200 rounded"></span> ë¶ˆì•ˆ</div>
                <div class="flex items-center gap-1"><span class="w-4 h-4 bg-green-200 rounded"></span> í‰ì˜¨</div>
                <div class="flex items-center gap-1"><span class="w-4 h-4 bg-orange-200 rounded"></span> ì„¤ë ˜</div>
            </div>
        </div>

        <!-- í†µê³„ íƒ­ -->
        <div id="statsTab" class="tab-content hidden bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-semibold mb-6 text-center">ê°ì • í†µê³„</h2>
            <div class="max-w-md mx-auto">
                <canvas id="emotionChart"></canvas>
            </div>
            <div id="statsDetails" class="mt-6 grid grid-cols-2 sm:grid-cols-3 gap-4"></div>
        </div>

        <!-- ì¼ê¸° ëª©ë¡ íƒ­ -->
        <div id="listTab" class="tab-content hidden bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-semibold mb-6 text-center">ì¼ê¸° ëª©ë¡</h2>
            
            <!-- ê²€ìƒ‰ ë° í•„í„° -->
            <div class="mb-6 space-y-4">
                <input type="text" id="searchInput" onkeyup="searchDiaries()" 
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400" 
                    placeholder="ì¼ê¸° ë‚´ìš© ê²€ìƒ‰...">
                <div class="flex flex-wrap gap-2">
                    <input type="date" id="filterStartDate" onchange="filterDiaries()" 
                        class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400">
                    <span class="flex items-center">~</span>
                    <input type="date" id="filterEndDate" onchange="filterDiaries()" 
                        class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400">
                    <select id="filterEmotion" onchange="filterDiaries()" 
                        class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-400">
                        <option value="">ëª¨ë“  ê°ì •</option>
                        <option value="happy">ğŸ˜Š í–‰ë³µ</option>
                        <option value="sad">ğŸ˜¢ ìŠ¬í””</option>
                        <option value="angry">ğŸ˜¡ í™”ë‚¨</option>
                        <option value="anxious">ğŸ˜° ë¶ˆì•ˆ</option>
                        <option value="peaceful">ğŸ˜Œ í‰ì˜¨</option>
                        <option value="excited">ğŸ¤— ì„¤ë ˜</option>
                    </select>
                </div>
            </div>
            
            <div id="diaryList" class="space-y-4"></div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentEmotion = '';
        let currentEmoji = '';
        let diaries = [];
        let currentDate = new Date();
        let hasPassword = false;

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
            document.getElementById('diaryDate').value = new Date().toISOString().split('T')[0];
            
            // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            loadDiaries();
            
            // ë¹„ë°€ë²ˆí˜¸ ì²´í¬
            checkPasswordProtection();
            
            // ë‹¬ë ¥ ì´ˆê¸°í™”
            renderCalendar();
        });

        // ë¹„ë°€ë²ˆí˜¸ ë³´í˜¸ í™•ì¸
        function checkPasswordProtection() {
            const savedPassword = localStorage.getItem('diaryPassword');
            if (savedPassword) {
                hasPassword = true;
                document.getElementById('passwordModal').classList.remove('hidden');
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            const savedPassword = localStorage.getItem('diaryPassword');
            
            if (!savedPassword) {
                // ì²« ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
                localStorage.setItem('diaryPassword', btoa(input));
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                document.getElementById('passwordModal').classList.add('hidden');
            } else if (btoa(input) === savedPassword) {
                document.getElementById('passwordModal').classList.add('hidden');
            } else {
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ê±´ë„ˆë›°ê¸°
        function skipPassword() {
            document.getElementById('passwordModal').classList.add('hidden');
        }

        // ê°ì • ì„ íƒ
        function selectEmotion(emotion, emoji) {
            currentEmotion = emotion;
            currentEmoji = emoji;
            
            // ëª¨ë“  ë²„íŠ¼ ì„ íƒ í•´ì œ
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected', 'ring-4', 'ring-purple-400');
            });
            
            // ì„ íƒëœ ë²„íŠ¼ í‘œì‹œ
            event.target.closest('.emotion-btn').classList.add('selected', 'ring-4', 'ring-purple-400');
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-purple-500', 'text-white');
                btn.classList.add('bg-white');
            });
            
            // ì„ íƒëœ íƒ­ í‘œì‹œ
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            event.target.classList.remove('bg-white');
            event.target.classList.add('bg-purple-500', 'text-white');
            
            // íƒ­ë³„ ì´ˆê¸°í™”
            if (tabName === 'calendar') {
                renderCalendar();
            } else if (tabName === 'stats') {
                showStats();
            } else if (tabName === 'list') {
                showDiaryList();
            }
        }

        // ì¼ê¸° ì €ì¥
        function saveDiary() {
            if (!currentEmotion) {
                alert('ê°ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }
            
            const diary = {
                id: Date.now(),
                date: document.getElementById('diaryDate').value,
                emotion: currentEmotion,
                emoji: currentEmoji,
                content: document.getElementById('diaryContent').value,
                grateful: [
                    document.getElementById('grateful1').value,
                    document.getElementById('grateful2').value,
                    document.getElementById('grateful3').value
                ].filter(item => item.trim() !== ''),
                weather: document.getElementById('weather').value,
                withPerson: document.getElementById('withPerson').value
            };
            
            // ê¸°ì¡´ ì¼ê¸° í™•ì¸ (ê°™ì€ ë‚ ì§œ)
            const existingIndex = diaries.findIndex(d => d.date === diary.date);
            if (existingIndex !== -1) {
                if (confirm('ì´ë¯¸ ì´ ë‚ ì§œì— ì¼ê¸°ê°€ ìˆìŠµë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    diaries[existingIndex] = diary;
                } else {
                    return;
                }
            } else {
                diaries.push(diary);
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('moodDiaries', JSON.stringify(diaries));
            
            alert('ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’œ');
            
            // í¼ ì´ˆê¸°í™”
            resetForm();
        }

        // í¼ ì´ˆê¸°í™”
        function resetForm() {
            currentEmotion = '';
            currentEmoji = '';
            document.getElementById('diaryContent').value = '';
            document.getElementById('grateful1').value = '';
            document.getElementById('grateful2').value = '';
            document.getElementById('grateful3').value = '';
            document.getElementById('weather').value = '';
            document.getElementById('withPerson').value = '';
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('selected', 'ring-4', 'ring-purple-400');
            });
        }

        // ì¼ê¸° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadDiaries() {
            const saved = localStorage.getItem('moodDiaries');
            if (saved) {
                diaries = JSON.parse(saved);
            }
        }

        // ë‹¬ë ¥ ë Œë”ë§
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = `${year}ë…„ ${month + 1}ì›”`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();
            
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';
            
            // ìš”ì¼ í—¤ë”
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center font-semibold text-gray-600 p-2';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // ë¹ˆ ì¹¸ ì±„ìš°ê¸°
            for (let i = 0; i < firstDay; i++) {
                const emptyDiv = document.createElement('div');
                calendar.appendChild(emptyDiv);
            }
            
            // ë‚ ì§œ ì±„ìš°ê¸°
            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const dayDiary = diaries.find(d => d.date === dateStr);
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day border rounded-lg p-2 cursor-pointer relative';
                
                if (dayDiary) {
                    const emotionColors = {
                        happy: 'bg-yellow-200',
                        sad: 'bg-blue-200',
                        angry: 'bg-red-200',
                        anxious: 'bg-purple-200',
                        peaceful: 'bg-green-200',
                        excited: 'bg-orange-200'
                    };
                    dayDiv.classList.add(emotionColors[dayDiary.emotion]);
                    dayDiv.innerHTML = `
                        <div class="font-semibold">${date}</div>
                        <div class="text-2xl">${dayDiary.emoji}</div>
                    `;
                    dayDiv.onclick = () => viewDiary(dayDiary);
                } else {
                    dayDiv.classList.add('bg-gray-50');
                    dayDiv.innerHTML = `<div class="text-gray-500">${date}</div>`;
                }
                
                calendar.appendChild(dayDiv);
            }
        }

        // ì›” ë³€ê²½
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar();
        }

        // í†µê³„ í‘œì‹œ
        function showStats() {
            const emotionCounts = {
                happy: 0,
                sad: 0,
                angry: 0,
                anxious: 0,
                peaceful: 0,
                excited: 0
            };
            
            diaries.forEach(diary => {
                emotionCounts[diary.emotion]++;
            });
            
            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            const ctx = document.getElementById('emotionChart').getContext('2d');
            
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (window.emotionChart) {
                window.emotionChart.destroy();
            }
            
            window.emotionChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['í–‰ë³µ ğŸ˜Š', 'ìŠ¬í”” ğŸ˜¢', 'í™”ë‚¨ ğŸ˜¡', 'ë¶ˆì•ˆ ğŸ˜°', 'í‰ì˜¨ ğŸ˜Œ', 'ì„¤ë ˜ ğŸ¤—'],
                    datasets: [{
                        data: Object.values(emotionCounts),
                        backgroundColor: [
                            '#fde047',
                            '#93c5fd',
                            '#fca5a5',
                            '#d8b4fe',
                            '#86efac',
                            '#fdba74'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // ìƒì„¸ í†µê³„
            const statsDetails = document.getElementById('statsDetails');
            statsDetails.innerHTML = '';
            
            const emotionNames = {
                happy: 'í–‰ë³µ ğŸ˜Š',
                sad: 'ìŠ¬í”” ğŸ˜¢',
                angry: 'í™”ë‚¨ ğŸ˜¡',
                anxious: 'ë¶ˆì•ˆ ğŸ˜°',
                peaceful: 'í‰ì˜¨ ğŸ˜Œ',
                excited: 'ì„¤ë ˜ ğŸ¤—'
            };
            
            Object.entries(emotionCounts).forEach(([emotion, count]) => {
                if (count > 0) {
                    const statDiv = document.createElement('div');
                    statDiv.className = 'text-center p-4 bg-gray-50 rounded-lg';
                    statDiv.innerHTML = `
                        <div class="text-2xl mb-2">${emotionNames[emotion]}</div>
                        <div class="text-3xl font-bold text-purple-600">${count}</div>
                        <div class="text-sm text-gray-500">ì¼</div>
                    `;
                    statsDetails.appendChild(statDiv);
                }
            });
        }

        // ì¼ê¸° ëª©ë¡ í‘œì‹œ
        function showDiaryList() {
            const diaryList = document.getElementById('diaryList');
            diaryList.innerHTML = '';
            
            const sortedDiaries = [...diaries].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedDiaries.forEach(diary => {
                const diaryCard = document.createElement('div');
                diaryCard.className = 'bg-gray-50 rounded-lg p-4 cursor-pointer hover:bg-gray-100';
                diaryCard.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="text-2xl">${diary.emoji}</span>
                            <span class="font-semibold">${diary.date}</span>
                            ${diary.weather ? `<span class="text-sm text-gray-500 ml-2">${diary.weather}</span>` : ''}
                        </div>
                        <button onclick="deleteDiary(${diary.id})" class="text-red-500 hover:text-red-700">ğŸ—‘ï¸</button>
                    </div>
                    <p class="text-gray-700 line-clamp-2">${diary.content}</p>
                    ${diary.grateful.length > 0 ? `<p class="text-sm text-purple-600 mt-2">ê°ì‚¬: ${diary.grateful.join(', ')}</p>` : ''}
                `;
                diaryCard.onclick = (e) => {
                    if (!e.target.closest('button')) {
                        viewDiary(diary);
                    }
                };
                diaryList.appendChild(diaryCard);
            });
        }

        // ì¼ê¸° ë³´ê¸°
        function viewDiary(diary) {
            // ì¼ê¸° ì“°ê¸° íƒ­ìœ¼ë¡œ ì „í™˜
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            document.getElementById('writeTab').classList.remove('hidden');
            
            // ë°ì´í„° ì±„ìš°ê¸°
            document.getElementById('diaryDate').value = diary.date;
            document.getElementById('diaryContent').value = diary.content;
            if (diary.grateful[0]) document.getElementById('grateful1').value = diary.grateful[0];
            if (diary.grateful[1]) document.getElementById('grateful2').value = diary.grateful[1];
            if (diary.grateful[2]) document.getElementById('grateful3').value = diary.grateful[2];
            document.getElementById('weather').value = diary.weather || '';
            document.getElementById('withPerson').value = diary.withPerson || '';
            
            // ê°ì • ì„ íƒ
            currentEmotion = diary.emotion;
            currentEmoji = diary.emoji;
            
            // ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
            window.scrollTo(0, 0);
        }

        // ì¼ê¸° ì‚­ì œ
        function deleteDiary(id) {
            if (confirm('ì´ ì¼ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                diaries = diaries.filter(d => d.id !== id);
                localStorage.setItem('moodDiaries', JSON.stringify(diaries));
                showDiaryList();
            }
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        function searchDiaries() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            filterDiaries();
        }

        // í•„í„°ë§ ê¸°ëŠ¥
        function filterDiaries() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const startDate = document.getElementById('filterStartDate').value;
            const endDate = document.getElementById('filterEndDate').value;
            const emotionFilter = document.getElementById('filterEmotion').value;
            
            let filtered = diaries;
            
            // ê²€ìƒ‰ì–´ í•„í„°
            if (searchTerm) {
                filtered = filtered.filter(diary => 
                    diary.content.toLowerCase().includes(searchTerm) ||
                    diary.grateful.some(g => g.toLowerCase().includes(searchTerm))
                );
            }
            
            // ë‚ ì§œ í•„í„°
            if (startDate) {
                filtered = filtered.filter(diary => diary.date >= startDate);
            }
            if (endDate) {
                filtered = filtered.filter(diary => diary.date <= endDate);
            }
            
            // ê°ì • í•„í„°
            if (emotionFilter) {
                filtered = filtered.filter(diary => diary.emotion === emotionFilter);
            }
            
            // ê²°ê³¼ í‘œì‹œ
            const diaryList = document.getElementById('diaryList');
            diaryList.innerHTML = '';
            
            const sortedFiltered = filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedFiltered.forEach(diary => {
                const diaryCard = document.createElement('div');
                diaryCard.className = 'bg-gray-50 rounded-lg p-4 cursor-pointer hover:bg-gray-100';
                diaryCard.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="text-2xl">${diary.emoji}</span>
                            <span class="font-semibold">${diary.date}</span>
                        </div>
                        <button onclick="deleteDiary(${diary.id})" class="text-red-500 hover:text-red-700">ğŸ—‘ï¸</button>
                    </div>
                    <p class="text-gray-700 line-clamp-2">${diary.content}</p>
                `;
                diaryList.appendChild(diaryCard);
            });
        }

        // ë‹¤í¬ëª¨ë“œ í† ê¸€
        function toggleDarkMode() {
            document.body.classList.toggle('dark');
            if (document.body.classList.contains('dark')) {
                document.body.classList.add('bg-gray-900', 'text-white');
                document.body.classList.remove('bg-purple-50');
            } else {
                document.body.classList.remove('bg-gray-900', 'text-white');
                document.body.classList.add('bg-purple-50');
            }
        }

        // ì„¤ì • ë³´ê¸°
        function showSettings() {
            const action = prompt('ì„¤ì • ë©”ë‰´\n1. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½\n2. ë¹„ë°€ë²ˆí˜¸ ì œê±°\n3. ë°ì´í„° ë‚´ë³´ë‚´ê¸°\n4. ë°ì´í„° ê°€ì ¸ì˜¤ê¸°\n\në²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            
            switch(action) {
                case '1':
                    changePassword();
                    break;
                case '2':
                    removePassword();
                    break;
                case '3':
                    exportData();
                    break;
                case '4':
                    importData();
                    break;
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
        function changePassword() {
            const newPassword = prompt('ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (newPassword) {
                localStorage.setItem('diaryPassword', btoa(newPassword));
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ì œê±°
        function removePassword() {
            if (confirm('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('diaryPassword');
                alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            const dataStr = JSON.stringify(diaries, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `ë§ˆìŒì¼ê¸°_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const imported = JSON.parse(e.target.result);
                        if (confirm(`${imported.length}ê°œì˜ ì¼ê¸°ë¥¼ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ? ê¸°ì¡´ ë°ì´í„°ëŠ” ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.`)) {
                            diaries = imported;
                            localStorage.setItem('moodDiaries', JSON.stringify(diaries));
                            alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!');
                            location.reload();
                        }
                    } catch (error) {
                        alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
    </script>
</body>
</html>